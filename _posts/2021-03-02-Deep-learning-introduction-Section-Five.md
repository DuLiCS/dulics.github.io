---

layout: post
title: 深度学习入门  基于Python的理论实现
subtitle: 第五章 误差反向传播法
tags: [Machine learning, Reading]

---

<head>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script>
</head>



# 第四章 误差反向传播法

上一章介绍了神经网络的学习，并通过数值微分计算了神经网络的权重参数的梯度，数值微分虽然简单，但是计算起来比较浪费时间。本章使用一个能够高效计算权重参数的梯度的方法--误差反向传播法。
正确理解反向传播法，有两种方法，一种基于**计算图**，一种基于数学式。后者是比较常见的方法，本章通过计算图来理解。

### 5.1 计算图

#### 5.1.1 用计算图求解

我们尝试用计算图解决问题，目的是为了让大家熟悉计算图。

**问题1**：太郎在超市买了 2 个 100 日元一个的苹果，消费税是 10%，请计算支付金额。

计算图通过节点和箭头表示计算过程，节点用圆圈表示，圆圈内是计算的内容。将计算的中间结果写在箭头上方，表示各个节点的计算结果从左向右传递，对于上述问题，求解过程如图所示。
![计算图1](/img/comput_graph_1.png)

开始时，苹果的100日元流到 $\times2$ 节点，变成200日元，然后传递到下一个节点，流向 $\times1.1$ 节点，变成220日元。因此答案是220日元。
上图中把 $\times2$ $\times1.1$ 整体扩起来，不过只用圆圈表示 $\times$ 也是可以的，此时，可以将 2 和 1.1 分别作为变量“苹果的个数”和“消费税”表在外面。
![计算图2](/img/comput_graph_2.png)

**问题2**：太郎在超市买了两个苹果三个橘子，其中，苹果每个100日元。橘子每个150日元，消费税是10%，请计算支付金额。按照上面的思路，求解过程如图所示。
![计算图3](/img/comput_graph_3.png)

综上，用计算图解题的流程如下：

1.*构建计算图*

2.*在计算图上从左向右计算*

第二部的“从左向右计算”是一种正方向上的传播过程，称为**正向传播**，与之相对应的是**反向传播**。

#### 5.1.2 局部计算

计算图可以通过传递“局部计算”获得最终结果。下面是一个局部计算的例子。

![计算图4](/img/comput_graph_4.png)

这个图也很好理解，结论是，无论全局计算有多么复杂，只要按照步骤，都可以最终计算出结果。


#### 5.1.3 为何用计算图解题

优点一：局部计算，无论全局多么复杂的计算，都可以通过局部计算使各个节点致力于简单的计算。
优点二：通过反向传播计算导数。

我们重新思考问题1，假设我们想知道苹果价格的波动会在多大程度上影响最终支付的金额，也就是求“支付金额关于苹果价格的导数”，设苹果价格为 $x$,支付金额为 $L$，则相当于求 $\frac{\partial L}{\partial x}$。

现在使用计算图的反向传播求这个导数。

![计算图5](/img/comput_graph_5.png)

如上图所示，反向传播使用与正方向相反的箭头（粗线）表示。反向传播传递“局部导数”，将导数值写在下方，这里坠重支付金额关于苹果价格的导数是2.2，也就是说苹果价格每上升1元，最终支付金额会上涨2.2元。

### 5.2 链式法则

#### 5.2.1 计算图的反向传播

假设存在 $y = f(x)$ 的计算，这个计算的反向传播如图所示。

![计算图6](/img/comput_graph_6.png)

反向传播的计算顺序是，将信号E乘以节点的局部导数 $\frac{\partial y}{\partial x}$，然后将结果传递给下一个节点，这里所说的局部导数是指正向传播中 $y = f(x)$ 的导数，也就是y关于x的导数 $\frac{\partial y}{\partial x}$。比如，假设 $y = f(x) = x^2$ ，
则 局 部 导 数 为 $\frac{\partial y}{\partial x}= 2x$  。 把 这 个 局 部 导 数 乘 以 上 游 传 过 来 的 值 ( 本 例 中 为 E )， 然后传递给前面的节点。
